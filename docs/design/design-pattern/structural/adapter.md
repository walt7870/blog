# é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)

## æ¦‚è¿°

å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

ç®€å•è¯´ï¼Œå°±æ˜¯**è®©å¯¹æ¥ä¸ä¸Šçš„æ¥å£ä¹Ÿèƒ½å¯¹ä¸Š**ï¼Œåƒä¸€ä¸ªæ’å¤´è½¬æ¢å™¨ï¼ŒæŠŠAæ¥å£è½¬æ¢æˆBæ¥å£ã€‚

é€‚é…å™¨æ¨¡å¼æ˜¯æ¡¥æ¢è®¾è®¡å·¥å…·ï¼Œå®ƒè®©â€œä¸å…¼å®¹â€çš„ç±»ä¹Ÿèƒ½åä½œï¼Œæ˜¯åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„å‰æä¸‹å®ç°ä»£ç å¤ç”¨çš„å¼ºåŠ›æ­¦å™¨ï¼Œé€‚ç”¨äºç³»ç»Ÿé›†æˆå’Œç³»ç»Ÿæ”¹é€ ä¸­ã€‚

## ä½¿ç”¨åœºæ™¯

- ä½¿ç”¨ä¸€ä¸ªå·²æœ‰ç±»ï¼Œä½†å®ƒçš„æ¥å£å’Œå½“å‰ç³»ç»Ÿè¦æ±‚ä¸å…¼å®¹ï¼›

- æƒ³å¤ç”¨ä¸€äº›è€ä»£ç ç³»ç»Ÿã€ç¬¬ä¸‰æ–¹åº“ï¼Œä½†ä¸æƒ³æ”¹å®ƒä»¬ï¼›

- å¸Œæœ›è§£è€¦â€œç›®æ ‡ç³»ç»Ÿâ€å’Œâ€œè¢«é€‚é…è€…â€çš„è€¦åˆå…³ç³»ã€‚

## ç±»å›¾ç»“æ„ï¼ˆä»¥ç±»é€‚é…å™¨ä¸ºä¾‹ï¼‰

```plaintext
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Target     â”‚ â† å®¢æˆ·ç«¯æœŸæœ›çš„æ¥å£ï¼ˆç›®æ ‡ï¼‰
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Adapter      â”‚ â† é€‚é…å™¨ï¼Œå®ç° Targetï¼Œå†…éƒ¨è°ƒç”¨ Adaptee
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Adaptee      â”‚ â† è¢«é€‚é…è€…ï¼Œå·²æœ‰ç±»
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## ç¤ºä¾‹

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª 220V ç”µæºï¼ˆAdapteeï¼‰ï¼Œç°åœ¨æ‰‹æœºåªèƒ½ä½¿ç”¨ 5V ç”µå‹ï¼ˆTargetï¼‰ï¼Œæˆ‘ä»¬ç”¨é€‚é…å™¨å°†å…¶è½¬æ¢ã€‚

### 1. ç›®æ ‡æ¥å£ï¼ˆTargetï¼‰

``` java
public interface DC5 {
    int output5V();
}
```

### 2. è¢«é€‚é…è€…ï¼ˆAdapteeï¼‰

``` java
public class AC220 {
    public int output220V() {
        return 220;
    }
}
```

### 3. é€‚é…å™¨ï¼ˆAdapterï¼‰

``` java
public class PowerAdapter implements DC5 {
    private AC220 ac220;

    public PowerAdapter(AC220 ac220) {
        this.ac220 = ac220;
    }

    @Override
    public int output5V() {
        int src = ac220.output220V();
        // æ¨¡æ‹Ÿå˜å‹å¤„ç†
        int dst = src / 44;
        System.out.println("é€‚é…å™¨ï¼šå°†" + src + "Vè½¬æ¢ä¸º" + dst + "V");
        return dst;
    }
}

```

### 4. å®¢æˆ·ç«¯è°ƒç”¨

```java
public class Client {
    public static void main(String[] args) {
        AC220 ac220 = new AC220();
        DC5 adapter = new PowerAdapter(ac220);

        int voltage = adapter.output5V();
        System.out.println("æ‰‹æœºæ¥æ”¶åˆ°ç”µå‹ï¼š" + voltage + "V");
    }
}

```

## ä¼˜ç¼ºç‚¹åˆ†æ

### âœ… ä¼˜ç‚¹

| ä¼˜ç‚¹               | è¯´æ˜                      |
| ---------------- | ----------------------- |
| **1. è§£è€¦å®¢æˆ·ç«¯ä¸æ—§æ¥å£** | å®¢æˆ·ç«¯ä¾èµ–çš„æ˜¯ç›®æ ‡æ¥å£è€Œä¸æ˜¯è¢«é€‚é…è€…ï¼Œæ¾è€¦åˆã€‚ |
| **2. æé«˜å¤ç”¨æ€§**     | é€‚é…å™¨å¯ä»¥å¤ç”¨æ—§ä»£ç /ç¬¬ä¸‰æ–¹ç±»ï¼Œæ— éœ€æ”¹åŠ¨å®ƒä»¬ã€‚ |
| **3. ç¬¦åˆå¼€é—­åŸåˆ™**    | æ–°å¢é€‚é…å™¨å³å¯æ‰©å±•ç³»ç»Ÿï¼ŒåŸæœ‰ä»£ç æ— é¡»ä¿®æ”¹ã€‚   |

### âŒ ç¼ºç‚¹

| ç¼ºç‚¹                 | è¯´æ˜                     |
| ------------------ | ---------------------- |
| **1. å¢åŠ ä»£ç å¤æ‚æ€§**     | ç³»ç»Ÿä¸­å¤šå‡ºä¸€å±‚é€‚é…å™¨ä»£ç ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬ã€‚   |
| **2. å¤šé‡é€‚é…åµŒå¥—æ—¶ç»“æ„å¤æ‚** | å¦‚æœéœ€è¦å¤šå±‚é€‚é…ï¼Œç»“æ„å®¹æ˜“æ··ä¹±ã€ä¸æ˜“è¿½è¸ªã€‚  |
| **3. ä¸æ”¯æŒæ‰€æœ‰æƒ…å†µ**     | æŸäº›æ¥å£ç»“æ„å·®å¼‚å¤ªå¤§æ—¶ï¼Œé€‚é…ä¸ç°å®æˆ–æ•ˆç‡ä½ã€‚ |

## é€‚é…å™¨åˆ†ç±»ï¼ˆæŒ‰å®ç°æ–¹å¼ï¼‰

| ç±»å‹        | ç‰¹ç‚¹                                    | å®ç°æ–¹å¼ç¤ºä¾‹                                            |
| --------- | ------------------------------------- | ------------------------------------------------- |
| **ç±»é€‚é…å™¨**  | ä½¿ç”¨**ç»§æ‰¿**å®ç°é€‚é…ï¼ˆåªèƒ½é€‚é…ä¸€ä¸ªç±»ï¼‰                 | `class Adapter extends Adaptee implements Target` |
| **å¯¹è±¡é€‚é…å™¨** | ä½¿ç”¨**ç»„åˆ**æ–¹å¼æŒæœ‰è¢«é€‚é…å¯¹è±¡ï¼Œæ›´çµæ´»ï¼Œæ¨è ä½¿ç”¨            | è§ä¸Šé¢ä»£ç ä¸­çš„ PowerAdapter                              |
| **æ¥å£é€‚é…å™¨** | é’ˆå¯¹æ¥å£ä¸­çš„å¤šä¸ªæ–¹æ³•ï¼Œ**åªå®ç°éƒ¨åˆ†æ–¹æ³•**ï¼ˆé€šå¸¸ç”¨äºæ¡†æ¶å›è°ƒï¼Œå¦‚ç›‘å¬å™¨ï¼‰ | Java ä¸­å¸¸é€šè¿‡æŠ½è±¡ç±»é»˜è®¤å®ç°æ¥å£æ‰€æœ‰æ–¹æ³•                            |


## Springä¸­çš„åº”ç”¨ HandlerAdapter

### èƒŒæ™¯

Spring MVC ä¸­çš„ HandlerAdapter æ˜¯å¯¹é€‚é…å™¨æ¨¡å¼çš„ç»å…¸å®ç°ï¼Œå®ƒå°†æ§åˆ¶å™¨ï¼ˆå„ç§é£æ ¼ï¼‰å’Œå‰ç«¯æ§åˆ¶å™¨è§£è€¦ï¼Œä½¿æ•´ä¸ªå¤„ç†å™¨è°ƒç”¨æœºåˆ¶çµæ´»ã€å¯æ‰©å±•ã€ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œç±»ä¼¼è®¾ç½®è¿˜æœ‰ViewResolverã€HttpMessageConverterï¼ŒåŠSpringBoot ä¸­å¯¹ starter çš„è‡ªåŠ¨è£…é…é€‚é…ã€‚

åœ¨ Spring MVC ä¸­ï¼Œå‰ç«¯æ§åˆ¶å™¨ DispatcherServlet çš„èŒè´£æ˜¯æ ¹æ®ç”¨æˆ·è¯·æ±‚ï¼Œè°ƒç”¨å¯¹åº”çš„å¤„ç†å™¨ï¼ˆå³ Controllerï¼‰ã€‚
ä½†é—®é¢˜æ˜¯ï¼šå¤„ç†å™¨æœ‰å¤šç§é£æ ¼/ç±»å‹ï¼ˆä¼ ç»Ÿ Controllerã€æ³¨è§£ Controllerã€å‡½æ•°å¼ Handler ç­‰ï¼‰ï¼Œå¦‚ä½•ç»Ÿä¸€è°ƒç”¨å‘¢ï¼Ÿ

ğŸ‘‰ è¿™å°±å¼•å‡ºäº† HandlerAdapterï¼ˆé€‚é…å™¨ï¼‰æœºåˆ¶ã€‚



### ç±»ç»“æ„å›¾

``` plaintext
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    DispatcherServlet    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                          findé€‚é…å™¨ï¼ˆéå†åˆ—è¡¨ï¼‰
                                  â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     HandlerAdapter      â”‚ â† ç›®æ ‡æ¥å£
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SimpleControllerâ”‚  â”‚ RequestMappingAdapter â”‚     â”‚ FunctionHandlerAdapter â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ï¼ˆé€‚é…ä¼ ç»Ÿ Controllerï¼‰     ï¼ˆé€‚é…æ³¨è§£ Controllerï¼‰        ï¼ˆé€‚é…å‡½æ•°å¼ Handlerï¼‰

```

### æ ¸å¿ƒæ¥å£ï¼šHandlerAdapter

```java
public interface HandlerAdapter {
    boolean supports(Object handler);       // æ˜¯å¦æ”¯æŒè¯¥å¤„ç†å™¨å¯¹è±¡
    ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;
    long getLastModified(HttpServletRequest request, Object handler);
}
```

#### è¯´æ˜

1. supports()ï¼šåˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ç±»å‹çš„å¤„ç†å™¨ï¼ˆå¦‚æ˜¯å¦æ˜¯HandlerMethodï¼‰

2. handle()ï¼šå…·ä½“é€‚é…æ‰§è¡Œ

3. DispatcherServlet å¹¶ä¸å…³å¿ƒ handler æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå®ƒåªéœ€è¦æ‰¾åˆ°å¯¹åº”çš„ HandlerAdapterï¼Œäº¤ç»™å®ƒå»å¤„ç†


#### å…¸å‹å®ç°ï¼šRequestMappingHandlerAdapter

è¿™æ˜¯æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„æ³¨è§£é£æ ¼ Controllerï¼ˆ@Controller @RequestMappingï¼‰çš„é€‚é…å™¨ï¼š

```java
public class RequestMappingHandlerAdapter implements HandlerAdapter {
    @Override
    public boolean supports(Object handler) {
        return handler instanceof HandlerMethod;  // æ”¯æŒæ³¨è§£é£æ ¼çš„æ–¹æ³•
    }

    @Override
    public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        // æ‰§è¡Œ Controller æ–¹æ³•
    }
}

```

#### DispatcherServlet ä¸­çš„è°ƒç”¨æµç¨‹ï¼ˆç®€åŒ–ï¼‰

```java
// æ ¸å¿ƒä¼ªä»£ç ï¼š
Object handler = getHandler(request);  // æŸ¥æ‰¾ Controllerï¼ˆå¯èƒ½æ˜¯ HandlerMethod ç­‰ï¼‰

for (HandlerAdapter adapter : handlerAdapters) {
    if (adapter.supports(handler)) {
        adapter.handle(request, response, handler);  // è°ƒç”¨åŒ¹é…é€‚é…å™¨
        break;
    }
}

```

##### è¯´æ˜

- DispatcherServlet å¹¶ä¸å…³å¿ƒ handler çš„å…·ä½“ç±»å‹ï¼›

- å®ƒåªéœ€è¦æ‰¾åˆ°åˆé€‚çš„é€‚é…å™¨æ¥æ‰§è¡Œå—ï¼Œè¿™æ­£æ˜¯å…¸å‹çš„é€‚é…å™¨æ¨¡å¼åº”ç”¨ã€‚